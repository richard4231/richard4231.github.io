<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kompetenzradar</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React und ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Additional React dependencies -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.js"></script>
    
    <!-- D3 (Recharts dependency) -->
    <script src="https://unpkg.com/d3-scale@4.0.2/dist/d3-scale.min.js"></script>
    <script src="https://unpkg.com/d3-shape@3.1.0/dist/d3-shape.min.js"></script>
    <script src="https://unpkg.com/d3-array@3.2.0/dist/d3-array.min.js"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.10.3/dist/recharts.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Basis-Styling */
        body {
            background-color: #f3f4f6;
            margin: 0;
            padding: 20px;
        }
        .form-radio {
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            border: 1px solid #d1d5db;
            appearance: none;
            cursor: pointer;
        }
        .form-radio:checked {
            background-color: #2563eb;
            border-color: #2563eb;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const {
            RadarChart,
            PolarGrid,
            PolarAngleAxis,
            PolarRadiusAxis,
            Radar,
            ResponsiveContainer,
            Legend
        } = window.Recharts;

        // Card Komponenten
        const Card = ({ children }) => (
            <div className="bg-white rounded-lg shadow-md overflow-hidden">
                {children}
            </div>
        );

        const CardHeader = ({ children }) => (
            <div className="px-6 py-4 border-b border-gray-200">
                {children}
            </div>
        );

        const CardTitle = ({ children }) => (
            <h2 className="text-xl font-semibold text-gray-800">
                {children}
            </h2>
        );

        const CardContent = ({ children }) => (
            <div className="p-6">
                {children}
            </div>
        );

        // Hauptkomponente
        function KompetenzRadar() {
            console.log("KompetenzRadar wird gerendert"); // Debug-Log

            // Konfigurationsvariablen
            const MIN_WERT = 0;
            const MAX_WERT = 2;
            
            // Bereiche Definition
            const BEREICHE = [
                "Digitale Grundkompetenzen",
                "Kommunikation & Kollaboration",
                "Sicherheit",
                "Problemlösung",
                "Digitales Lehren & Lernen",
                "Digital Leadership",
                "Digital Administration"
            ];
            
            // Fragen Definition
            const FRAGEN = [
                {
                    id: 1,
                    text: "Wie häufig nutzen Sie digitale Werkzeuge im Alltag?",
                    bereich: "Digitale Grundkompetenzen",
                    ebene: "subjektiv",
                    antworten: [
                        { text: "Selten bis gar nicht", wert: 0 },
                        { text: "Gelegentlich", wert: 1 },
                        { text: "Sehr häufig", wert: 2 }
                    ]
                },
                {
                    id: 2,
                    text: "Wie sicher fühlen Sie sich im Umgang mit Online-Kollaborationstools?",
                    bereich: "Kommunikation & Kollaboration",
                    ebene: "subjektiv",
                    antworten: [
                        { text: "Unsicher", wert: 0 },
                        { text: "Einigermaßen sicher", wert: 1 },
                        { text: "Sehr sicher", wert: 2 }
                    ]
                },
                {
                    id: 3,
                    text: "Können Sie grundlegende Sicherheitsmaßnahmen im digitalen Umfeld nennen?",
                    bereich: "Sicherheit",
                    ebene: "objektiv",
                    antworten: [
                        { text: "Keine", wert: 0 },
                        { text: "1-2 Maßnahmen", wert: 1 },
                        { text: "3 oder mehr Maßnahmen", wert: 2 }
                    ]
                },
                {
                    id: 4,
                    text: "Wie sehr interessieren Sie sich für neue digitale Technologien?",
                    bereich: "Digitale Grundkompetenzen",
                    ebene: "interesse",
                    antworten: [
                        { text: "Kaum Interesse", wert: 0 },
                        { text: "Mittleres Interesse", wert: 1 },
                        { text: "Sehr großes Interesse", wert: 2 }
                    ]
                }
            ];

            // State für die Antworten
            const [antworten, setAntworten] = React.useState({});

            // Berechnung der aggregierten Werte für das Spiderdiagramm
            const chartData = React.useMemo(() => {
                console.log("Berechne chartData"); // Debug-Log
                
                // Initialisiere Objekt mit allen Bereichen und Ebenen
                const initialWerte = BEREICHE.reduce((acc, bereich) => {
                    acc[bereich] = {
                        subjektiv: 0,
                        objektiv: 0,
                        interesse: 0,
                        anzahlSubjektiv: 0,
                        anzahlObjektiv: 0,
                        anzahlInteresse: 0
                    };
                    return acc;
                }, {});

                // Sammle alle Antworten
                Object.entries(antworten).forEach(([fragenId, antwortWert]) => {
                    const frage = FRAGEN.find(f => f.id === parseInt(fragenId));
                    if (frage && initialWerte[frage.bereich]) {
                        initialWerte[frage.bereich][frage.ebene] += antwortWert;
                        initialWerte[frage.bereich][`anzahl${frage.ebene.charAt(0).toUpperCase()}${frage.ebene.slice(1)}`]++;
                    }
                });

                // Berechne Durchschnitte und formatiere für das Chart
                const result = BEREICHE.map(bereich => {
                    const bereichWerte = initialWerte[bereich];
                    return {
                        bereich,
                        subjektiv: bereichWerte.anzahlSubjektiv > 0 
                            ? bereichWerte.subjektiv / bereichWerte.anzahlSubjektiv 
                            : 0,
                        objektiv: bereichWerte.anzahlObjektiv > 0 
                            ? bereichWerte.objektiv / bereichWerte.anzahlObjektiv 
                            : 0,
                        interesse: bereichWerte.anzahlInteresse > 0 
                            ? bereichWerte.interesse / bereichWerte.anzahlInteresse 
                            : 0
                    };
                });
                
                console.log("Berechnete Daten:", result); // Debug-Log
                return result;
            }, [antworten]);

            // Handler für Antwortauswahl
            const handleAntwort = (fragenId, wert) => {
                console.log(`Neue Antwort: Frage ${fragenId}, Wert ${wert}`); // Debug-Log
                setAntworten(prev => ({
                    ...prev,
                    [fragenId]: wert
                }));
            };

            return (
                <div className="w-full max-w-6xl mx-auto p-4">
                    <Card>
                        <CardHeader>
                            <CardTitle>Kompetenzradar - Standortbestimmung</CardTitle>
                        </CardHeader>
                        <CardContent>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                {/* Fragebogen */}
                                <div className="space-y-6">
                                    {FRAGEN.map(frage => (
                                        <div key={frage.id} className="p-4 border rounded-lg space-y-3 bg-white shadow-sm">
                                            <h3 className="font-medium">{frage.text}</h3>
                                            <div className="flex space-x-2 text-sm text-gray-500">
                                                <span>Bereich: {frage.bereich}</span>
                                                <span>•</span>
                                                <span>Ebene: {frage.ebene}</span>
                                            </div>
                                            <div className="space-y-2">
                                                {frage.antworten.map((antwort, idx) => (
                                                    <label key={idx} className="flex items-center space-x-2 p-2 rounded hover:bg-gray-50">
                                                        <input
                                                            type="radio"
                                                            name={`frage-${frage.id}`}
                                                            value={antwort.wert}
                                                            checked={antworten[frage.id] === antwort.wert}
                                                            onChange={(e) => handleAntwort(frage.id, parseInt(e.target.value))}
                                                            className="form-radio"
                                                        />
                                                        <span>{antwort.text}</span>
                                                    </label>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                {/* Spiderdiagramm */}
                                <div className="h-96 bg-white p-4 rounded-lg">
                                    {RadarChart ? (
                                        <ResponsiveContainer width="100%" height="100%">
                                            <RadarChart data={chartData}>
                                                <PolarGrid />
                                                <PolarAngleAxis dataKey="bereich" />
                                                <PolarRadiusAxis angle={30} domain={[MIN_WERT, MAX_WERT]} />
                                                
                                                <Radar
                                                    name="Subjektive Einschätzung"
                                                    dataKey="subjektiv"
                                                    stroke="#2563eb"
                                                    fill="#2563eb"
                                                    fillOpacity={0.3}
                                                    type="monotone"
                                                />
                                                <Radar
                                                    name="Objektive Einschätzung"
                                                    dataKey="objektiv"
                                                    stroke="#16a34a"
                                                    fill="#16a34a"
                                                    fillOpacity={0.3}
                                                    type="monotone"
                                                />
                                                <Radar
                                                    name="Interesse"
                                                    dataKey="interesse"
                                                    stroke="#dc2626"
                                                    fill="#dc2626"
                                                    fillOpacity={0.3}
                                                    type="monotone"
                                                />
                                                <Legend />
                                            </RadarChart>
                                        </ResponsiveContainer>
                                    ) : (
                                        <div className="h-full flex items-center justify-center text-gray-500">
                                            Diagramm wird geladen...
                                        </div>
                                    )}
                                </div>
                            </div>
                        </CardContent>
                    </Card>
                </div>
            );
        }

        // React 18 Rendering mit Error Boundary
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }

            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }

            render() {
                if (this.state.hasError) {
                    return (
                        <div className="p-4 bg-red-100 text-red-700 rounded-lg">
                            <h2>Ein Fehler ist aufgetreten:</h2>
                            <pre>{this.state.error?.toString()}</pre>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        // Rendering mit Error Boundary
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(
            <ErrorBoundary>
                <KompetenzRadar />
            </ErrorBoundary>
        );
    </script>
</body>
</html>